# Vocal Take Manager - テスト計画

## 概要
E2Eテストを中心に、重要なユーザーフローをカバーするテストを実装します。
ユニットテストは計算/変換ロジックのみ最低限に絞ります。

---

## E2Eテストケース

### 1. ホーム画面テスト (`tests/home.spec.ts`)

#### 1.1 初期表示
- [ ] タイトルが表示される
- [ ] プロジェクトが空の状態のメッセージが表示される
- [ ] 新規ボタンが有効
- [ ] 開く/書き出しボタンが無効

#### 1.2 新規プロジェクト作成フロー
- [ ] 新規ボタンをクリックすると歌詞入力画面に遷移
- [ ] キャンセルボタンでホームに戻る
- [ ] 必須項目（タイトル、歌詞）が空の場合OKボタンが無効
- [ ] 正しく入力するとプロジェクトが作成される

#### 1.3 プロジェクト一覧
- [ ] 作成したプロジェクトが一覧に表示される
- [ ] プロジェクトをクリックして開く
- [ ] 最終更新日時が表示される

#### 1.4 プロジェクトの書き出し/読み込み
- [ ] .vtmファイルとして書き出し
- [ ] .vtmファイルから読み込み

---

### 2. 歌詞入力画面テスト (`tests/lyric-input.spec.ts`)

#### 2.1 フォーム入力
- [ ] タイトル入力
- [ ] クレジット入力
- [ ] 歌詞入力（複数行）

#### 2.2 バリデーション
- [ ] タイトル未入力でエラー
- [ ] 歌詞未入力でエラー

#### 2.3 ファイルインポート
- [ ] .txtファイルから歌詞をインポート
- [ ] .docxファイルから歌詞をインポート

#### 2.4 リハーサルマーク
- [ ] 【】で囲まれた行がリハーサルマークとして認識される

---

### 3. レコーディング画面テスト (`tests/recording.spec.ts`)

#### 3.1 初期表示
- [ ] タイトルが表示される
- [ ] 歌詞が行ごとに表示される
- [ ] テイク列が表示される
- [ ] 初期状態で1テイクが存在

#### 3.2 テイク管理
- [ ] テイクを追加
- [ ] テイクを削除（確認ダイアログ）
- [ ] テイクを折りたたみ/展開

#### 3.3 マーク入力
- [ ] セルをクリックして選択
- [ ] キーボード1-9でマーク入力
- [ ] キーボード0でメモ入力
- [ ] Delete/Backspaceでマーク削除
- [ ] マーク入力後自動的に次のフレーズへ移動

#### 3.4 ナビゲーション
- [ ] 左右キーでフレーズ移動
- [ ] 空行はスキップされる

#### 3.5 フレーズ編集
- [ ] 手動分割モードでフレーズを分割
- [ ] 手動削除モードで分割線を削除
- [ ] 歌詞修正モードでテキスト編集
- [ ] リハーサルマーク追加

#### 3.6 コンピング画面へ遷移
- [ ] 「セレクトモードに切り替える」ボタンで遷移

---

### 4. コンピング画面テスト (`tests/comping.spec.ts`)

#### 4.1 初期表示
- [ ] レコーディング画面と同じ歌詞/テイクが表示
- [ ] マークが表示される

#### 4.2 テイク選択
- [ ] キーボード1-9で対応テイクを採用
- [ ] Delete/Backspaceで採用解除
- [ ] 選択後自動的に次のフレーズへ移動

#### 4.3 採用表示
- [ ] 採用テイクが歌詞横にバッジで表示

#### 4.4 書き出し/印刷
- [ ] ソングプロジェクトの書き出し(.vtm)
- [ ] 印刷/PDF出力（ライトモード強制）

#### 4.5 レコーディング画面へ戻る
- [ ] 「レコーディングモードに戻る」ボタンで遷移

---

### 5. ダークモード/設定テスト (`tests/settings.spec.ts`)

#### 5.1 ダークモード切り替え
- [ ] ダークモードON/OFF
- [ ] 設定が永続化される

#### 5.2 フォント切り替え
- [ ] フォント選択が反映される
- [ ] 設定が永続化される

---

## ユニットテストケース（最低限）

### 1. ユーティリティ関数 (`src/utils/*.test.ts`)

#### 1.1 markHelpers
- [ ] `getMark` - マークの取得
- [ ] `setMarkValue` - マーク値の設定
- [ ] `clearMark` - マークの削除

#### 1.2 phraseHelpers
- [ ] `findNextSelectablePhrase` - 次の選択可能フレーズ
- [ ] `isSelectablePhrase` - 選択可能判定

#### 1.3 songHelpers
- [ ] `addTake` - テイク追加
- [ ] `removeTake` - テイク削除
- [ ] `splitPhraseByChar` - フレーズ分割
- [ ] `mergePhraseAtDivider` - フレーズ結合

#### 1.4 kuromojiAnalyzer
- [ ] 形態素解析結果の処理

---

## 実装優先順位

1. **ホーム画面テスト** - 基本フロー
2. **レコーディング画面テスト** - 主要機能
3. **コンピング画面テスト** - 主要機能
4. **歌詞入力画面テスト** - 入力フロー
5. **ユニットテスト** - ヘルパー関数
6. **設定テスト** - UI設定

---

## 備考

- E2Eテストは `tests/*.spec.ts` に配置
- ユニットテストは `src/**/*.test.ts` に配置
- テストデータは `tests/fixtures/` に配置
